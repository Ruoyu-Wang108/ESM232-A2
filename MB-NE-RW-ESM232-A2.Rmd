---
title: "ESM232 A2 function application"
author: "Margaret Brickner, Nathalie Eegholm, Ruoyu Wang"
date: "4/7/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)

source("R/almond_yield_anomaly.R")
```

```{r}
clim <- read.table("clim.txt")

precip <- clim %>% 
  filter(month == 1)

jan_precip_sum <- precip %>% 
  group_by(year) %>% 
  summarize(
    jan_precip_sum = sum(precip)
  )

temp <- clim %>% 
  filter(month == 2)

feb_temp_min <- temp %>% 
  group_by(year) %>%
  summarize(
    feb_tmin = min(tmin_c)
  )
  
#I added this code to calculate yield anomaly for each year. In my R script I called and filtered the data a bit differently, so can you make sure that this will get the right output in terms of calling the right columns, etc.? -Nathalie  

yset <- seq(from = unique(jan_precip_sum[1,1], to = tail(jan_precip_sum[,1],n=1),length.out = length(unique(jan_precip_sum[,1]))) #create a vector of years

yieldanoms<- NaN*(yset) #generate empty holding vector to store yield anomalies for each year

for(j in 1:length(yieldanoms)){ #loop through years

  yieldanoms[j]<-almond_yield_anomaly(feb_tmin[j,2],
                         jan_precip_sum[j,2],
                         var_feb_min_t_1 = -0.015,
                         var_feb_min_t_2 = -0.0046,
                         var_jan_precip_1 = -0.07,
                         var_jan_precip_2 = 0.0043,
                         intercept = 0.28)
                         
                         }
                         
                         
plot(x=yset,y=yieldanoms, xlab="year", ylab="yield anomaly (tons/acre)",type = 'l', las = 1, lwd = 2, main = "Almond Yield Anomaly, Lobell et al., 2006")

```

